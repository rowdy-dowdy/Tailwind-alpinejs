<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="../public/css/base.css">

  <script defer src="../public/js/global.js"></script>
  <script defer src="https://unpkg.com/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script defer src="../public/js/main.js"></script>
</head>

<body>
  <div class="2xl:container mx-auto px-4 py-14">
    <!-- list images -->
    <div class="flex flex-wrap -mx-4" x-data="list">

      <template x-for="item in items">
        <div class="w-1/3 px-4">
          <div class="rounded px-4 py-3 border hover:shadow-md">
            <div class="relative pb-[75%]">
              <a href="#" class="bg-absolute js-lazyload overflow-hidden">
                <span class="bg-loading"></span>
                <img :src="item.img" alt="1" class="img-cover" x-lazyload
                  loading="lazy">
                <span class="bg-error">
                  <i class='bx bx-error'></i>
                  <span class="text-base py-2">Không thể tải hình ảnh</span>
                </span>
              </a>
            </div>
            <div class="flex flex-col py-2">
              <h1><a href="#" class="text-xl font-semibold hover:text-primary-600 capitalize" x-text="item.title"></a>
              </h1>
              <p class="line-clamp-3">Lorem ipsum dolor sit amet consectetur adipisicing elit. A explicabo suscipit
                numquam optio fugiat at quia, porro sint nulla aliquid architecto! Rem tenetur dolor iste? Provident
                consequatur ipsam totam culpa.</p>
            </div>
          </div>
        </div>
      </template>

    </div>

    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('list', () => ({
          items: [
            {
              img: '../public/images/agustin-diaz-gargiulo-7F65HDP0-E0-unsplash.jpg2',
              title: 'Agustin diaz gargiulo'
            },
            {
              img: '../public/images/casey-horner-rtCujH697DU-unsplash.jpg',
              title: 'casey horner'
            },
            {
              img: '../public/images/pascal-habermann-A6hoSqrce5U-unsplash.jpg',
              title: 'pascal habermann'
            },
            {
              img: '../public/images/tim-foster-Sf23azHZRR4-unsplash.jpg',
              title: 'tim foster'
            },
            {
              img: '../public/images/yonatan-anugerah-3k0-K12TgLc-unsplash.jpg',
              title: 'yonatan anugerah'
            },
          ]
        }))
      })
    </script>

    <span x-data class="text-red-500" x-text="$store.model.text">ok la</span>

  </div>


  <!-- alpinejs main -->
  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.store('model', {
            on: true,
            text: 'hihi haha',
 
            toggle() {
                this.on = ! this.on
            }
        })


      if ("loading" in HTMLImageElement.prototype) {
        // type one
        Alpine.bind('lazyload', () => ({
          'x-init'() {
            this.$nextTick(() => {
              this.$el.parentNode.classList.add("loading");
            })
          },

          '@load' (e) {
            e.currentTarget.parentNode.classList.remove("loading");
          },

          '@error' (e) {
            let parent = e.currentTarget.parentNode;

            parent.classList.remove("loading");
            parent.classList.add("error");
          },
        }))

        // type two
        Alpine.directive('lazyload', (el, {}, { cleanup }) => {
          let handlerLoad = (e) => {
            e.currentTarget.parentNode.classList.remove("loading");
          }
          let handlerLoadError = (e) => {
            let parent = e.currentTarget.parentNode;

            parent.classList.remove("loading");
            parent.classList.add("error");
          }

          el.parentNode.classList.add("loading");
          el.addEventListener("load", handlerLoad);
          el.addEventListener("error", handlerLoadError);

          cleanup(() => {
            el.removeEventListener('load', handlerLoad)
            el.removeEventListener('error', handlerLoadError)
          })
        })
      }
    })
  </script>

  <!-- main js -->
  <script>
    //
    // layzyload image
    //
    function lazyLoadImage(e) {
      e.currentTarget.parentNode.classList.remove("loading");
    }

    function lazyLoadImageError(e) {
      let parent = e.currentTarget.parentNode;

      parent.classList.remove("loading");
      parent.classList.add("error");
    }

    function AddEventLazyLoadImage() {
      if ("loading" in HTMLImageElement.prototype) {
        let imgs = document.querySelectorAll(".js-lazyload img")

        if (imgs) {
          imgs.forEach((v) => {
            if (!v.complete) {
              v.parentNode.classList.add("loading");
              v.addEventListener("load", lazyLoadImage);
              v.addEventListener("error", lazyLoadImageError);
            }
          });
        }
      }
    }

    AddEventLazyLoadImage();
  </script>
</body>

</html>